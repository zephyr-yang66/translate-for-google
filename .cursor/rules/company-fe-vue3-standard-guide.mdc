---
level: 00
description: é‚¦é“ç§‘æŠ€ - å…¬å¸çº§é€šç”¨ Vue3 æ ‡å‡†å¼€å‘è§„èŒƒã€‚
globs: **/*.{ts,js,vue,css,less}
---

# Vue3 æ ‡å‡†å¼€å‘è§„èŒƒ

> Vue3 Composition APIçš„æ ‡å‡†åŒ–ä½¿ç”¨è§„èŒƒ,ç¡®ä¿ä»£ç é£æ ¼ç»Ÿä¸€å’Œè´¨é‡å¯æ§

## ğŸ¯ æ ¸å¿ƒè§„èŒƒ

### å¼ºåˆ¶ä½¿ç”¨ Composition API

```yaml
å¿…é¡»ä½¿ç”¨:
  - <script setup lang="ts"> è¯­æ³•
  - Composition API (ref, reactive, computedç­‰)
  - TypeScriptç±»å‹å®šä¹‰
```

## ğŸ“¦ ç»„ä»¶ç»“æ„æ ‡å‡†

```vue
<template>
  <div class="component-name"><!-- UI --></div>
</template>

<script setup lang="ts">
// 1. å¯¼å…¥: Vueæ ¸å¿ƒAPI -> ç¬¬ä¸‰æ–¹åº“ -> ç±»å‹ -> ç»„ä»¶ -> API -> å·¥å…·
import { ref, computed, watch, onMounted } from 'vue';
import type { FormInstance } from 'ant-design-vue';
import UserModal from './components/UserModal.vue';
import { getUserList } from '@/api/user';

// 2. ç±»å‹å®šä¹‰
interface UserInfo { id: number; name: string; }
interface Props { userId?: number; }
interface Emits { (e: 'update', data: UserInfo): void; }

// 3. Props/Emits
const props = defineProps<Props>();
const emit = defineEmits<Emits>();

// 4. å“åº”å¼æ•°æ®
const userList = ref<UserInfo[]>([]);

// 5. è®¡ç®—å±æ€§
const filteredList = computed(() => userList.value.filter(/* ... */));

// 6. ç›‘å¬å™¨
watch(() => props.userId, loadUserData);

// 7. æ–¹æ³•
const loadUserData = async (id: number) => { /* ... */ };

// 8. ç”Ÿå‘½å‘¨æœŸ
onMounted(() => loadUserData(props.userId));

// 9. æš´éœ²(å¯é€‰)
defineExpose({ loadUserData });
</script>

<style lang="less" scoped>
.component-name { /* ... */ }
</style>
```

## ğŸ”§ å“åº”å¼APIä½¿ç”¨è§„èŒƒ

```typescript
// ref - åŸºæœ¬ç±»å‹ã€éœ€æ•´ä½“æ›¿æ¢çš„å¯¹è±¡/æ•°ç»„
const count = ref(0);
const userList = ref<User[]>([]);

// reactive - å¤æ‚å¯¹è±¡ä¸”ä¸éœ€æ•´ä½“æ›¿æ¢
const formData = reactive({ name: '', age: 0 });

// æ€§èƒ½ä¼˜åŒ–
const largeList = shallowRef<any[]>([]); // å¤§æ•°æ®
const config = readonly({ apiUrl: '/api' }); // åªè¯»
```

## Computed ä½¿ç”¨è§„èŒƒ

```typescript
// æ´¾ç”Ÿæ•°æ®
const fullName = computed(() => `${firstName.value} ${lastName.value}`);

// å¯å†™computed(è°¨æ…ä½¿ç”¨)
const fullName = computed({
  get: () => `${firstName.value} ${lastName.value}`,
  set: (value) => [firstName.value, lastName.value] = value.split(' '),
});
```

## Watch ä½¿ç”¨è§„èŒƒ

```typescript
watch(userId, loadUserData); // ç›‘å¬å•ä¸ªref
watch([userId, roleId], ([uid, rid]) => loadData(uid, rid)); // ç›‘å¬å¤šä¸ª
watch(() => formData.name, (val) => console.log(val)); // ç›‘å¬reactiveå±æ€§
watch(() => formData, (val) => console.log(val), { deep: true, immediate: true }); // æ·±åº¦ç›‘å¬

// åœæ­¢ç›‘å¬
const stop = watch(userId, () => {});
onUnmounted(() => stop());
```

## ç”Ÿå‘½å‘¨æœŸä½¿ç”¨è§„èŒƒ

```typescript
// onMounted - åˆå§‹åŒ–
onMounted(() => {
  loadData();
  window.addEventListener('resize', handleResize);
});

// onUnmounted - æ¸…ç†
onUnmounted(() => {
  window.removeEventListener('resize', handleResize);
});
```

## ğŸ“¤ Props / Emits è§„èŒƒ

```typescript
// Props å®šä¹‰
interface Props {
  userId: number;     // å¿…å¡«
  userName?: string;  // å¯é€‰
  tags?: string[];    // å¸¦é»˜è®¤å€¼
}
const props = withDefaults(defineProps<Props>(), { tags: () => [] });
const { userId } = toRefs(props); // ä¿æŒå“åº”æ€§

// Emits å®šä¹‰
interface Emits {
  (e: 'update', data: UserInfo): void;
  (e: 'close'): void;
}
const emit = defineEmits<Emits>();
```

## Composables è§„èŒƒ

```typescript
// å‘½å: useå¼€å¤´, è¿”å›åªè¯»é¿å…å¤–éƒ¨ä¿®æ”¹
export function useCounter(initial = 0) {
  const count = ref(initial);
  return {
    count: readonly(count),
    increment: () => count.value++,
    decrement: () => count.value--,
  };
}
```

## æ¨¡æ¿å¼•ç”¨

```typescript
const inputRef = ref<HTMLInputElement>(); // å…ƒç´ å¼•ç”¨
const modalRef = ref<InstanceType<typeof Modal>>(); // ç»„ä»¶å¼•ç”¨
onMounted(() => inputRef.value?.focus());
```

## TypeScript ç±»å‹å®šä¹‰

```typescript
interface UserInfo {
  id: number;
  name: string;
  role: 'admin' | 'user';
  permissions?: string[];
}

type UserStatus = 'active' | 'inactive' | 'pending';

interface ApiResponse<T> { code: number; data: T; message: string; }
```

## æœ€ä½³å®è·µæ€»ç»“

```yaml
ç»„ä»¶æ‹†åˆ†: å•ä¸ªæ–‡ä»¶<500è¡Œ, å•ä¸ªå‡½æ•°<50è¡Œ, Props<10ä¸ª, å¤æ‚é€»è¾‘æŠ½å–Composable
å“åº”å¼: åŸºæœ¬ç±»å‹ç”¨ref, å¯¹è±¡æŒ‰åœºæ™¯é€‰æ‹©ref/reactive, å¤§æ•°æ®ç”¨shallowRef, åªè¯»ç”¨readonly
è®¡ç®—å±æ€§: ç”¨äºæ´¾ç”Ÿæ•°æ®, é¿å…å‰¯ä½œç”¨å’Œå¼‚æ­¥æ“ä½œ
ç›‘å¬å™¨: watchå“åº”æ•°æ®å˜åŒ–, watchEffectè‡ªåŠ¨è¿½è¸ªä¾èµ–, è®°å¾—æ¸…ç†å‰¯ä½œç”¨
ç”Ÿå‘½å‘¨æœŸ: onMountedåˆå§‹åŒ–, onUnmountedæ¸…ç†, é¿å…ä½¿ç”¨updateç›¸å…³é’©å­
```