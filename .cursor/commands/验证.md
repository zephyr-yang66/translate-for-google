---
description: 执行需求验证工作流，验证功能规范文档中定义的所有用户故事验收场景和功能需求是否在实际系统中得到正确实现。
---

## 用户输入

```text
$ARGUMENTS
```

在继续之前，你**必须**考虑用户输入（如果不为空）。

## 概述

1. **确定需求文件**：
   - 如果用户提供了文件路径，则验证该指定的需求文件
   - 如果用户未提供文件路径，则在项目中搜索所有 `*spec*.md` 文件（排除智能体文件 `docs/agents/spec-verify-engineer.md`），然后验证所有找到的需求文件

2. **加载验证上下文**：
   - 读取需求验证智能体定义：`docs/agents/spec-verify-engineer.md`
   - 读取测试目标配置：`docs/rules/testing/test-target.md`
   - 读取测试策略文档：`docs/rules/testing/root-rules.mdc` 和 `docs/rules/testing/project-rules.mdc`
   - 读取验证报告模板：`docs/templates/requirement-verification-report-template.md`

3. **执行验证工作流**：
   - 遵循 `spec-verify-engineer.md` 中定义的完整工作流程
   - 对于每个需求文件，执行完整的验证过程

## 工作流程

### 阶段0: 知识学习阶段
遵循项目统一规范（详见 `docs/rules/testing/root-rules.mdc` 和 `docs/rules/testing/project-rules.mdc`）

### 阶段1: 准备阶段

1. **读取需求文件**：
   - 如果用户指定了文件路径，读取该文件作为需求规格说明
   - 如果用户未指定，在项目中搜索 `*spec*.md` 文件：
     - 使用 `glob_file_search` 搜索匹配 `*spec*.md` 的文件
     - 排除 `docs/agents/spec-verify-engineer.md` 智能体文件
     - 对所有找到的需求文件进行验证
   
2. **读取测试目标配置**：
   - 读取 `docs/rules/testing/test-target.md`
   - 提取被测系统访问信息（系统名称、URL、测试账号、测试密码）

3. **解析需求内容**：
   - 提取所有用户故事和验收场景
   - 解析所有功能需求(FR)
   - 建立验证清单

### 阶段2: 文档制作阶段

1. **创建验证报告**：
   - 按照 `docs/templates/requirement-verification-report-template.md` 模板创建报告
   - 如果验证多个文件，为每个需求文件创建独立的验证报告
   - **报告命名格式**: `需求验证报告_{项目名称}_{YYYYMMDD}.md`
   - **保存路径**: `docs/rules/testing/outputs/`

2. **报告结构**（必须包含7个章节）：
   - 验证概览（统计表格和摘要）
   - 用户故事验收场景验证表
   - 功能需求(FR)验证表
   - 验证执行日志
   - 问题清单
   - 验证结论
   - 附录

### 阶段3: 系统验证阶段

1. **访问被测系统**：
   - 使用 Cursor 内部浏览器访问被测系统 URL
   - 执行登录操作（使用测试账号和密码）
   - 验证登录成功

2. **逐项验证**：
   - 验证所有用户故事的验收场景
   - 验证所有功能需求(FR)
   - 记录验证状态：通过 / 失败 / 阻碍
   - 保存必要的截图证据

3. **遵循验证策略**：
   - 弹窗/对话框测试策略
   - 搜索功能测试策略
   - 异常处理策略
   - 实际执行优先原则（必须真实执行所有操作）

### 阶段4: 结果整理阶段

1. **更新验证文档**：
   - 填充所有验证结果
   - 添加详细备注说明
   - 更新问题记录表

2. **生成统计信息**：
   - 计算验证通过率和失败率
   - 识别阻碍验证的问题
   - 生成验证摘要

3. **保存结果**：
   - 保存验证报告到 `docs/rules/testing/outputs/`
   - 保存所有截图到 `docs/rules/testing/outputs/`

## 验证结果标准

- **通过 (Pass)**: 实际系统行为完全符合需求描述
- **失败 (Fail)**: 实际系统行为与需求描述不符
- **阻碍 (Blocked)**: 前置条件不满足，无法进行验证

## 关键规则

- 使用绝对路径
- 必须实际执行所有测试场景（禁止以"避免数据污染"为理由不执行）
- 所有标记为"未测试"的场景都要重新测试并更新结果
- 验证完成后立即更新验证报告和统计信息
- 如果验证多个需求文件，需要为每个文件创建独立的验证报告

## 输出交付物

1. **需求验证报告**：`docs/rules/testing/outputs/需求验证报告_{项目名称}_{YYYYMMDD}.md`
2. **验证截图**：保存在 `docs/rules/testing/outputs/` 目录下

