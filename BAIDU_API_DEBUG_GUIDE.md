# 百度翻译 API 调试指南

**更新时间**: 2025-11-07

---

## 📋 问题诊断步骤

您遇到的错误提示"百度翻译服务暂时不可用，请检查网络连接后重试"，可能有以下几个原因：

### 1. 检查 API 配置是否正确

#### 1.1 获取百度翻译 API 密钥

1. 访问 [百度翻译开放平台](https://fanyi-api.baidu.com/)
2. 登录或注册账号
3. 进入「管理控制台」→「开发者信息」
4. 获取以下信息：
   - **APP ID**：例如 `20240101000001234`
   - **密钥**：例如 `abcdefghijklmnopqrstuvwxyz123456`

#### 1.2 检查配置是否填写

1. 打开 Chrome 扩展管理页面：`chrome://extensions/`
2. 找到「DeepSeek 翻译」扩展
3. 点击「详细信息」→「扩展程序选项」
4. 确认百度翻译配置区域：
   - ✅ APP ID 已填写（不是空的）
   - ✅ 密钥已填写（不是空的）
   - ✅ 没有多余的空格
   - ✅ 没有复制错误

### 2. 查看详细错误日志

我已经在代码中添加了详细的调试日志。请按照以下步骤查看：

#### 2.1 打开开发者控制台

1. 打开 Chrome 扩展管理页面：`chrome://extensions/`
2. 找到「DeepSeek 翻译」扩展
3. 点击「service worker」或「查看视图：背景页」（取决于 Chrome 版本）
4. 这会打开一个新的开发者工具窗口

#### 2.2 测试翻译并查看日志

1. 在扩展选项页面，点击「🧪 测试连接」按钮
2. 在开发者控制台中查看输出的日志信息
3. 记录以下关键信息：
   ```
   [百度翻译] 请求参数: { ... }
   [百度翻译] 请求URL: https://...
   [百度翻译] 响应状态: 200 OK
   [百度翻译] API响应数据: { ... }
   ```

#### 2.3 常见错误及解决方法

根据控制台的错误信息，对照下表进行排查：

| 错误信息 | 可能原因 | 解决方法 |
|---------|---------|---------|
| `配置缺失` | APP ID 或密钥未填写 | 在选项页面填写完整的百度翻译配置 |
| `状态码：400` | 请求参数错误 | 检查 APP ID 和密钥是否正确 |
| `状态码：401` 或 `错误码：52001` | APP ID 或密钥错误 | 重新复制正确的 APP ID 和密钥 |
| `错误码：52003` | 签名错误或认证失败 | 检查密钥是否正确，注意不要有多余空格 |
| `错误码：54003` | 访问频率受限 | 您的请求过于频繁，请稍后再试 |
| `错误码：54004` | 账户余额不足 | 检查百度翻译账户余额并充值 |
| `错误码：58000` | 客户端 IP 非法 | 在百度翻译控制台检查 IP 白名单设置 |
| `Failed to fetch` 或 `NetworkError` | 网络连接问题 | 检查网络连接，或检查防火墙/代理设置 |

### 3. 验证 API 签名生成

百度翻译 API 需要正确的 MD5 签名。签名生成公式为：

```
sign = MD5(appId + query + salt + secretKey)
```

其中：
- `appId`: 您的 APP ID
- `query`: 要翻译的文本
- `salt`: 随机数（时间戳）
- `secretKey`: 您的密钥

#### 3.1 手动验证签名

您可以使用以下在线工具验证 MD5 签名是否正确：

1. **准备签名字符串**：
   ```
   签名字符串 = APP_ID + 翻译文本 + 时间戳 + 密钥
   例如：20240101000001234Hello1699000000abcdefghijklmnopqrstuvwxyz123456
   ```

2. **计算 MD5**：
   - 访问 [MD5 在线计算工具](https://md5calc.com/)
   - 输入上面的签名字符串
   - 得到 MD5 值（小写）

3. **对比签名**：
   - 在控制台日志中找到 `[百度翻译] 请求参数` 输出的 `sign` 值
   - 与您手动计算的 MD5 值对比是否一致

### 4. 检查网络连接

#### 4.1 测试百度翻译 API 是否可访问

1. 打开浏览器，访问：
   ```
   https://fanyi-api.baidu.com/api/trans/vip/translate
   ```

2. 如果显示错误信息（如缺少参数），说明 API 服务器可访问
3. 如果无法访问，可能是：
   - 网络问题
   - 防火墙阻止
   - 代理设置问题

#### 4.2 检查浏览器扩展权限

1. 打开 `chrome://extensions/`
2. 找到「DeepSeek 翻译」扩展
3. 检查「权限」部分是否包含网络访问权限

### 5. 尝试其他翻译服务

如果百度翻译一直无法使用，您可以：

1. **使用 LibreTranslate**（免费，无需 API 密钥）：
   - 在扩展选项页面选择「LibreTranslate」
   - URL 填写：`https://libretranslate.com`
   - 点击保存即可使用

2. **使用 DeepSeek**（需要 API 密钥）：
   - 在扩展选项页面选择「DeepSeek」
   - 填写您的 DeepSeek API 密钥
   - 点击测试连接

3. **启用自动备用切换**：
   - 在扩展选项页面勾选「启用自动备用切换」
   - 当主 API 失败时，会自动尝试其他配置的 API

---

## 🐛 常见问题排查清单

请按顺序检查以下项目：

- [ ] 1. APP ID 和密钥已正确填写（无空格、无错误）
- [ ] 2. 在百度翻译控制台确认账户状态正常
- [ ] 3. 在百度翻译控制台检查账户余额充足（如果是付费用户）
- [ ] 4. 浏览器能正常访问百度翻译 API 域名
- [ ] 5. 检查了开发者控制台的详细错误日志
- [ ] 6. 尝试重新保存配置并重新加载扩展
- [ ] 7. 尝试使用其他翻译服务（LibreTranslate 或 DeepSeek）

---

## 📝 报告问题

如果以上步骤都无法解决问题，请提供以下信息以便进一步诊断：

1. **开发者控制台的完整日志**（截图或文字）
2. **API 配置信息**（脱敏后的 APP ID，如 `2024****1234`）
3. **测试的文本内容**
4. **浏览器版本**（Chrome/Edge 等）
5. **网络环境**（是否使用代理、防火墙等）

---

## 🔍 深度调试

如果需要更深入的调试，可以：

### 方法1：使用 curl 直接测试 API

在终端运行以下命令（替换成您的实际配置）：

```bash
# 设置变量
APP_ID="您的APP_ID"
SECRET_KEY="您的密钥"
TEXT="Hello"
SALT=$(date +%s)

# 生成签名（macOS/Linux）
SIGN_STR="${APP_ID}${TEXT}${SALT}${SECRET_KEY}"
SIGN=$(echo -n "$SIGN_STR" | md5)

# 发送请求
curl "https://fanyi-api.baidu.com/api/trans/vip/translate?q=${TEXT}&from=en&to=zh&appid=${APP_ID}&salt=${SALT}&sign=${SIGN}"
```

如果 curl 命令能成功返回翻译结果，说明 API 配置正确，问题在于扩展代码。

### 方法2：检查 MD5 实现

我在代码中实现了自定义的 MD5 函数。如果怀疑 MD5 实现有问题，可以：

1. 在开发者控制台运行：
   ```javascript
   // 测试 MD5 函数
   const testStr = 'Hello, World!';
   // 使用扩展的 MD5 函数
   console.log('扩展 MD5:', md5(testStr));
   // 正确的 MD5 应该是: 65a8e27d8879283831b664bd8b7f0ad4
   ```

2. 对比结果是否正确

---

## ✅ 更新日志

### 2025-11-07
- ✅ 添加详细的请求日志输出
- ✅ 添加配置验证（检查 APP ID 和密钥是否为空）
- ✅ 改进错误信息，区分不同类型的错误
- ✅ 添加 HTTP 响应体日志
- ✅ 改进网络错误的错误提示

---

如有其他问题，欢迎随时反馈！

