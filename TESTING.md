# DeepSeek 翻译扩展测试指南

本文档提供详细的测试步骤，用于验证扩展是否满足所有功能需求和验收场景。

## 前置准备

### 1. 构建扩展

```bash
npm install
npm run build
```

### 2. 加载到 Chrome

1. 打开 Chrome 浏览器
2. 访问 `chrome://extensions/`
3. 启用右上角的「开发者模式」
4. 点击「加载已解压的扩展程序」
5. 选择项目的 `dist/` 目录
6. 确认扩展已成功加载

> **注意**：如果提示图标文件缺失，可以忽略该警告。扩展功能不受影响。

### 3. 打开开发者工具

为了查看日志和调试，建议打开：
- **Background Script 控制台**：在扩展管理页面点击「service worker」
- **Content Script 控制台**：在测试网页按 F12 打开开发者工具

---

## 功能需求测试

### FR-01: 文本选择识别

**测试页面**：https://en.wikipedia.org/wiki/Google_Translate

| 测试项 | 步骤 | 预期结果 |
|--------|------|----------|
| 单词选择 | 选中单词 "translate" | 能够正确识别 |
| 句子选择 | 选中完整句子 | 能够正确识别 |
| 多行选择 | 选中多个段落 | 能够正确识别 |
| 带标签文本 | 选中包含链接的文本 | 仅提取纯文本 |

**验证方法**：
1. 选中文本后右键翻译
2. 查看抽屉中的「原文」区域
3. 确认文本完整且格式正确

---

### FR-02: 右键菜单集成

**测试步骤**：

1. **未选中文本时**
   - 在网页空白处右键
   - 验证：菜单中**不应**显示翻译选项

2. **选中文本后**
   - 选中任意英文文本
   - 右键点击
   - 验证：菜单中显示「使用 DeepSeek 翻译」选项

3. **点击菜单项**
   - 点击翻译选项
   - 验证：抽屉在 500 毫秒内从右侧滑入

**通过标准**：✅ 菜单显示逻辑正确，点击后抽屉立即打开

---

### FR-03: 翻译抽屉 UI

**UI 检查项**：

| 检查项 | 标准 | 验证 |
|--------|------|------|
| 抽屉位置 | 浏览器窗口右侧 | ☐ |
| 抽屉宽度 | 最大 400px 或 30vw | ☐ |
| 抽屉高度 | 占满整个窗口高度 | ☐ |
| 背景色 | 白色 | ☐ |
| 层级 | 显示在网页内容之上 | ☐ |
| 关闭按钮 | 右上角，清晰可见 | ☐ |
| 打开动画 | 从右向左滑入，300ms | ☐ |
| 关闭动画 | 从左向右滑出，300ms | ☐ |
| 阴影效果 | 有明显的视觉边界 | ☐ |

**测试步骤**：
1. 触发翻译打开抽屉
2. 观察动画是否流畅
3. 检查抽屉宽度和高度
4. 点击关闭按钮，观察关闭动画

---

### FR-04: 原文展示区域

**测试内容**：

1. **短文本显示**
   - 选中 5-10 个单词
   - 验证：原文完整显示，无截断

2. **长文本显示**
   - 选中 200+ 词的段落
   - 验证：出现滚动条，可以滚动查看全部内容

3. **格式保留**
   - 选中包含换行的多段落文本
   - 验证：换行和段落格式保留

**通过标准**：✅ 原文区域最小高度 100px，长文本可滚动

---

### FR-05: 译文展示区域

**测试内容**：

1. **加载状态**
   - 触发翻译
   - 验证：显示「翻译中，请稍候...」和加载动画

2. **成功状态**
   - 等待翻译完成
   - 验证：显示中文译文，字体清晰，字号 16-18px

3. **失败状态**
   - 断开网络后触发翻译
   - 验证：显示友好的错误提示

**字体检查**：译文应使用中文友好字体（PingFang SC 或 Microsoft YaHei）

---

### FR-06: DeepSeek API 集成

**测试用例**：

1. **单词翻译**
   ```
   原文: documentation
   期望: 文档
   ```

2. **句子翻译**
   ```
   原文: This is a comprehensive guide for developers.
   期望: 这是一份面向开发者的综合指南。
   ```

3. **技术术语翻译**
   ```
   原文: API, database, authentication
   期望: 准确翻译技术术语
   ```

**性能要求**：
- 90% 的翻译请求在 3 秒内返回
- 查看 Console 日志确认响应时间

**错误处理测试**：

| 场景 | 模拟方法 | 预期提示 |
|------|----------|----------|
| 网络超时 | 断开网络 10 秒后重连 | "翻译请求超时..." |
| 网络错误 | 完全断开网络 | "翻译服务暂时不可用..." |
| API 错误 | 使用无效 API 密钥 | "翻译服务返回错误..." |

---

### FR-07: 多翻译支持

**测试步骤**：

1. 选中文本 A，触发翻译，抽屉打开
2. 保持抽屉打开
3. 在网页中选中文本 B
4. 右键再次触发翻译
5. 验证：
   - 抽屉保持打开（不关闭再重开）
   - 抽屉内容更新为文本 B 的翻译
   - 旧翻译被覆盖

**通过标准**：✅ 可以连续翻译多次，无需关闭抽屉

---

## 验收场景测试

### 场景 1: 单词翻译

**步骤**：
1. 访问 https://en.wikipedia.org
2. 选中单词 "documentation"
3. 右键点击 → 选择「使用 DeepSeek 翻译」
4. 观察抽屉

**预期结果**：
- ✅ 抽屉从右侧滑出
- ✅ 原文：documentation
- ✅ 译文：文档

---

### 场景 2: 句子翻译

**步骤**：
1. 选中句子："This is a comprehensive guide for developers."
2. 触发翻译

**预期结果**：
- ✅ 译文流畅：「这是一份面向开发者的综合指南。」

---

### 场景 3: 多段落翻译

**步骤**：
1. 在维基百科页面选中 3-5 个段落（约 300 词）
2. 触发翻译
3. 滚动查看完整译文

**预期结果**：
- ✅ 原文区域出现滚动条
- ✅ 译文区域出现滚动条
- ✅ 内容完整，可以滚动查看全部

---

### 场景 4: 网络错误处理

**步骤**：
1. 打开飞行模式或断开网络
2. 选中文本并触发翻译
3. 观察抽屉

**预期结果**：
- ✅ 抽屉打开，显示「翻译中...」
- ✅ 10 秒后显示错误提示
- ✅ 错误信息：「翻译服务暂时不可用，请检查网络连接后重试」
- ✅ 错误样式：红色边框或背景，警告图标

---

### 场景 5: 关闭抽屉

**步骤**：
1. 打开翻译抽屉
2. 点击右上角的「×」关闭按钮
3. 观察抽屉关闭动画

**预期结果**：
- ✅ 抽屉向右滑出并消失
- ✅ 动画流畅，无卡顿
- ✅ 网页可以正常浏览

---

### 场景 6: 连续翻译

**步骤**：
1. 选中并翻译第一段文本
2. 保持抽屉打开
3. 选中页面中的另一段文本
4. 再次右键翻译
5. 观察抽屉

**预期结果**：
- ✅ 抽屉保持打开（不关闭再重开）
- ✅ 原文和译文更新为新内容
- ✅ 旧内容被完全覆盖

---

## 非功能需求测试

### 性能测试

1. **翻译响应时间**
   - 测试 10 次翻译
   - 记录每次响应时间（查看 Console 日志）
   - 验证：95% 的请求在 5 秒内完成

2. **UI 渲染性能**
   - 打开/关闭抽屉 10 次
   - 观察动画是否流畅
   - 验证：帧率不低于 30 FPS

3. **内存占用**
   - 打开 Chrome 任务管理器（Shift + Esc）
   - 查看扩展内存占用
   - 验证：空闲状态下不超过 50 MB

---

### 兼容性测试

在以下网站测试扩展是否正常工作：

- ☐ Wikipedia (https://en.wikipedia.org)
- ☐ GitHub (https://github.com)
- ☐ Stack Overflow (https://stackoverflow.com)
- ☐ Medium (https://medium.com)
- ☐ 技术文档站点 (https://developer.mozilla.org)

验证：
- 抽屉样式不受网页样式影响
- 右键菜单正常显示
- 翻译功能正常

---

### 安全性测试

1. **HTTPS 验证**
   - 打开 Network 面板
   - 触发翻译
   - 验证：API 请求使用 HTTPS 协议

2. **API 密钥保护**
   - 检查 Console 和 Network 面板
   - 验证：API 密钥不暴露在日志中（已加密传输）

---

## 测试报告模板

完成测试后，可以使用以下模板记录结果：

```markdown
# 测试报告

**测试日期**：2025-11-07
**测试人员**：[姓名]
**Chrome 版本**：[版本号]

## 功能需求测试结果

- [ ] FR-01: 文本选择识别 - ✅ 通过 / ❌ 失败
- [ ] FR-02: 右键菜单集成 - ✅ 通过 / ❌ 失败
- [ ] FR-03: 翻译抽屉 UI - ✅ 通过 / ❌ 失败
- [ ] FR-04: 原文展示区域 - ✅ 通过 / ❌ 失败
- [ ] FR-05: 译文展示区域 - ✅ 通过 / ❌ 失败
- [ ] FR-06: DeepSeek API 集成 - ✅ 通过 / ❌ 失败
- [ ] FR-07: 多翻译支持 - ✅ 通过 / ❌ 失败

## 验收场景测试结果

- [ ] 场景 1: 单词翻译 - ✅ 通过 / ❌ 失败
- [ ] 场景 2: 句子翻译 - ✅ 通过 / ❌ 失败
- [ ] 场景 3: 多段落翻译 - ✅ 通过 / ❌ 失败
- [ ] 场景 4: 网络错误处理 - ✅ 通过 / ❌ 失败
- [ ] 场景 5: 关闭抽屉 - ✅ 通过 / ❌ 失败
- [ ] 场景 6: 连续翻译 - ✅ 通过 / ❌ 失败

## 发现的问题

1. [问题描述]
   - 重现步骤：
   - 预期结果：
   - 实际结果：
   - 严重程度：

## 总体评价

[整体测试结论和建议]
```

---

## 常见问题排查

### 问题 1: 右键菜单没有出现

**可能原因**：
- 扩展未正确加载
- 没有选中文本

**解决方法**：
1. 检查 `chrome://extensions/` 确认扩展已启用
2. 确保选中了文本
3. 刷新网页后重试

---

### 问题 2: 翻译一直显示加载中

**可能原因**：
- API 密钥无效
- 网络连接问题
- DeepSeek API 服务不可用

**解决方法**：
1. 检查 Background Script 控制台的错误日志
2. 验证 API 密钥是否正确
3. 检查网络连接
4. 确认 DeepSeek API 服务状态

---

### 问题 3: 抽屉样式异常

**可能原因**：
- 网页 CSS 冲突
- dist/drawer.css 未正确加载

**解决方法**：
1. 检查 dist 目录是否包含 drawer.css
2. 在开发者工具中检查样式是否加载
3. 尝试在不同网站测试

---

### 问题 4: 图标未显示

**说明**：这是预期的，因为项目使用占位图标。

**解决方法**：
- 扩展功能不受影响，可以正常使用
- 如需添加图标，在 `dist/icons/` 目录放置对应尺寸的 PNG 文件

---

## 自动化测试建议

未来可以使用以下工具进行自动化测试：

1. **Puppeteer**：自动化浏览器操作
2. **Jest**：单元测试
3. **Chrome Extension Testing Framework**

当前版本采用手动测试即可满足需求。

