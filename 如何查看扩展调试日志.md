# 如何查看浏览器扩展的调试日志

## 📋 您的百度翻译配置

- **APP ID**: `20251107002493001`
- **密钥**: `ET4V_d46sun4a3kf3dr8rhte0`

---

## 🔍 查看 Background Script 日志

### 步骤 1: 打开扩展管理页面
在浏览器地址栏输入：
```
chrome://extensions/
```

### 步骤 2: 开启开发者模式
确保右上角的「开发者模式」开关是打开的。

### 步骤 3: 找到「DeepSeek 翻译」扩展
找到您的扩展，点击「service worker」链接。

### 步骤 4: 查看控制台日志
在打开的控制台中，您会看到详细的日志：

```
[百度翻译] 签名生成详情:
  步骤1_拼接字符串: 'appid + q + salt + 密钥'
  步骤2_实际拼接: '20251107002493001 + Hello%2C+World... + 1731234567890 + ET4V...'
  步骤3_签名字符串长度: 67
  步骤4_MD5签名: 'abc123...'

[百度翻译] 请求参数:
  text: 'Hello, World'
  appId: '20251107002493001'
  salt: '1731234567890'
  sign: 'abc123...'

[百度翻译] 响应状态: 200 OK

[百度翻译] API响应数据:
  {
    "from": "en",
    "to": "zh",
    "trans_result": [...]
  }
```

---

## 🧪 在扩展中测试

### 方法 1: 使用设置页面的测试按钮

1. 点击扩展图标 → 「设置」
2. 输入您的 APP ID 和密钥
3. 点击「保存设置」
4. 点击「测试连接」按钮
5. 查看测试结果

### 方法 2: 在网页中实际使用

1. 访问任意英文网页（如 GitHub）
2. 选中一段英文文本
3. 右键 → 「使用 DeepSeek 翻译」
4. 查看右侧抽屉中的翻译结果
5. 同时在 service worker 控制台查看详细日志

---

## ⚠️ 为什么测试工具会报 CORS 错误？

### 普通网页的限制

`baidu-sign-test.html` 是一个普通的 HTML 文件，当您在浏览器中打开它时：

```
文件协议: file:///path/to/baidu-sign-test.html
Origin: null
```

百度翻译 API 的 CORS 策略：
- ❌ **不允许** 从 `null` origin 访问
- ❌ **不允许** 从普通网页访问
- ✅ **允许** 从浏览器扩展访问（通过 host_permissions）

### 浏览器扩展的优势

浏览器扩展有特殊权限：

```json
// manifest.json
{
  "host_permissions": [
    "https://fanyi-api.baidu.com/*"
  ]
}
```

这样 background script 就可以绕过 CORS 限制，直接调用百度 API。

---

## 🎯 推荐的测试流程

### 1. 确认配置正确 ✓

您的配置看起来是正确的：
- APP ID: `20251107002493001` ✓
- 密钥: `ET4V_d46sun4a3kf3dr8rhte0` ✓

### 2. 在扩展中测试

不要使用 `baidu-sign-test.html`，而是：
1. 打开 `chrome://extensions/`
2. 刷新「DeepSeek 翻译」扩展
3. 进入扩展设置页面
4. 填写配置并测试

### 3. 查看详细日志

打开 service worker 控制台，查看以下关键日志：

| 日志标记 | 说明 |
|---------|------|
| `[百度翻译] 签名生成详情` | 查看签名生成的每一步 |
| `[百度翻译] 请求参数` | 查看发送的参数 |
| `[百度翻译] 响应状态` | 查看 API 返回的状态码 |
| `[百度翻译] API响应数据` | 查看完整的响应内容 |
| `[百度翻译] API错误详情` | 如果出错，查看错误详情 |

### 4. 根据日志判断问题

#### 如果看到成功日志：
```
[百度翻译] 翻译成功: "你好，世界"
```
✅ 说明配置正确，可以正常使用！

#### 如果看到错误码 54001：
```
[百度翻译] API错误详情:
  错误码: "54001"
  错误信息: "签名错误..."
```
❌ 说明签名有问题，需要检查：
1. APP ID 是否完全正确
2. 密钥是否完全正确
3. 配置中是否有多余空格

#### 如果看到其他错误码：
参考 `BAIDU_SIGN_FIX.md` 中的错误码对照表。

---

## 📞 如果问题仍未解决

请提供以下信息：

1. **Service Worker 控制台的完整日志截图**
   - 特别是 `[百度翻译]` 开头的所有日志
   
2. **错误码**（如果有）
   - 错误码：`_____`
   - 错误信息：`_____`

3. **测试场景**
   - 使用的测试文本
   - 在哪个页面测试的
   - 是否刷新了扩展

---

## 🎉 预期的成功结果

当一切正常时，您应该看到：

### 在扩展设置页面：
```
✅ 测试成功！百度翻译 API 连接正常。
```

### 在 Service Worker 控制台：
```
[百度翻译] 签名生成详情: {...}
[百度翻译] 请求参数: {...}
[百度翻译] 响应状态: 200 OK
[百度翻译] API响应数据: {
  "from": "en",
  "to": "zh",
  "trans_result": [{
    "src": "Hello world",
    "dst": "你好世界"
  }]
}
[百度翻译] 翻译成功: 你好世界
```

### 在网页中：
- 选中英文文本
- 右键点击翻译
- 右侧抽屉显示中文翻译结果
- 翻译准确无误

---

**记住**：不要使用 `baidu-sign-test.html` 进行实际测试，它只是用来理解签名生成流程的教学工具。真正的测试要在浏览器扩展中进行！

