# 多 API 翻译浏览器扩展

一个**安全、免费、可靠**的 Chrome 浏览器翻译扩展，支持多种翻译服务，通过右键菜单快速将英文翻译为中文。

## ✨ 功能特性

### 🎯 核心功能
- 🚀 **快速翻译**：选中文本 → 右键 → 翻译，即时获取中文译文
- 🎨 **侧边抽屉**：翻译结果显示在浏览器右侧抽屉中，不遮挡网页内容
- 📝 **原文对照**：同时显示原文和译文，方便对照阅读
- ⚡ **响应迅速**：缓存命中时接近即时响应，一般翻译在 3 秒内完成

### 🆓 多 API 支持
- **百度翻译**（推荐）：每月 200 万字符免费，翻译质量优秀
- **LibreTranslate**：完全免费，无使用限制，开源方案
- **DeepSeek AI**：翻译质量最好，但为付费服务

### 🔐 安全特性
- ✅ **API 密钥保护**：不再硬编码密钥，安全存储在本地
- ✅ **请求频率限制**：防止 API 滥用（30次/分钟，500次/小时）
- ✅ **智能缓存**：相同文本不重复调用 API，节省成本
- ✅ **备用方案**：主 API 失败自动切换到备用 API

## 开发技术栈

- TypeScript
- Vite
- Chrome Extension Manifest V3
- DeepSeek API

## 安装依赖

```bash
npm install
```

## 构建扩展

```bash
npm run build
```

构建完成后，扩展文件将输出到 `dist/` 目录。

## 加载到 Chrome 浏览器

1. 打开 Chrome 浏览器
2. 访问 `chrome://extensions/`
3. 在右上角启用「开发者模式」
4. 点击「加载已解压的扩展程序」
5. 选择项目的 `dist/` 目录
6. 扩展加载成功后，图标会出现在工具栏中

## 使用方法

1. 访问任意包含英文内容的网页
2. 用鼠标选中要翻译的英文文本
3. 右键点击选中的文本
4. 在菜单中选择「使用 DeepSeek 翻译」
5. 浏览器右侧会滑出翻译抽屉，显示原文和译文
6. 点击抽屉右上角的「×」关闭抽屉

## 功能需求覆盖

根据功能规格文档 (spec.md)，本扩展实现了以下功能：

### 用户故事
- ✅ US-01: 快速翻译选中文本
- ✅ US-02: 查看翻译历史（原文和译文对照）
- ✅ US-03: 关闭翻译抽屉

### 功能需求
- ✅ FR-01: 文本选择识别
- ✅ FR-02: 右键菜单集成
- ✅ FR-03: 翻译抽屉 UI
- ✅ FR-04: 原文展示区域
- ✅ FR-05: 译文展示区域
- ✅ FR-06: DeepSeek API 集成
- ✅ FR-07: 多翻译支持

### 验收场景
- ✅ 场景 1: 单词翻译
- ✅ 场景 2: 句子翻译
- ✅ 场景 3: 多段落翻译
- ✅ 场景 4: 网络错误处理
- ✅ 场景 5: 关闭抽屉
- ✅ 场景 6: 连续翻译

## 测试建议

### 基础功能测试

1. **单词翻译测试**
   - 访问一个英文网页（例如：https://en.wikipedia.org）
   - 选中单词 "documentation"
   - 右键选择「使用 DeepSeek 翻译」
   - 验证翻译结果是否正确（应显示：文档）

2. **句子翻译测试**
   - 选中完整句子："This is a comprehensive guide for developers."
   - 触发翻译
   - 验证译文是否准确流畅

3. **长文本翻译测试**
   - 选中包含多个段落的长文本（约 300 词）
   - 触发翻译
   - 验证抽屉中是否出现滚动条，内容是否完整显示

4. **连续翻译测试**
   - 打开翻译抽屉后，不关闭抽屉
   - 选中网页中的其他文本
   - 再次触发翻译
   - 验证抽屉内容是否更新为新的翻译

5. **错误处理测试**
   - 断开网络连接
   - 触发翻译
   - 验证是否显示友好的错误提示

### UI/UX 测试

1. **抽屉动画**：验证抽屉打开和关闭动画是否流畅
2. **响应式布局**：验证不同屏幕宽度下抽屉显示是否正常
3. **样式隔离**：在不同网站上测试，确保抽屉样式不受网页样式影响
4. **关闭按钮**：验证点击关闭按钮后抽屉是否正确关闭

### 性能测试

1. **翻译速度**：验证大多数翻译请求在 3-5 秒内完成
2. **内存占用**：使用 Chrome 任务管理器查看扩展内存占用

## 项目结构

```
/
├── src/
│   ├── background.ts          # 后台脚本，处理右键菜单
│   ├── content.ts            # 内容脚本，注入抽屉 UI
│   ├── drawer/
│   │   ├── drawer.ts         # 抽屉逻辑
│   │   └── drawer.css        # 抽屉样式
│   ├── api/
│   │   └── deepseek.ts       # DeepSeek API 封装
│   ├── types.ts              # TypeScript 类型定义
│   └── config.ts             # 配置文件（API 密钥等）
├── public/
│   ├── manifest.json         # 扩展配置
│   └── icons/                # 扩展图标
├── dist/                     # 构建输出目录
├── package.json
├── tsconfig.json
└── vite.config.ts
```

## ⚙️ 配置说明

### 首次使用（重要！）

⚠️ **v2.0 版本移除了硬编码的 API 密钥（安全考虑）**，您需要自行配置：

1. **安装扩展后自动打开配置页面**
2. **选择翻译服务**（推荐百度翻译）
3. **填写 API 密钥**
4. **测试并保存**

### 获取免费 API 密钥

#### 方案一：百度翻译（推荐）⭐

**优点：每月 200 万字符免费，翻译质量好**

1. 访问 [百度翻译开放平台](https://fanyi-api.baidu.com/)
2. 注册并登录账号
3. 进入「管理控制台」→「开发者信息」
4. 获取 **APP ID** 和**密钥**
5. 完成身份认证以获得免费额度

#### 方案二：LibreTranslate（完全免费）

**优点：完全免费，无限制**

1. 在配置页面选择 LibreTranslate
2. 使用默认地址即可（无需注册）
3. 或自建服务器获得更好性能

#### 方案三：DeepSeek AI（不推荐）

**仅当您需要最佳翻译质量且不介意付费时使用**

1. 访问 [DeepSeek 开放平台](https://platform.deepseek.com/)
2. 注册并获取 API 密钥
3. 注意：每次翻译约花费 ¥0.002

### 推荐配置

```
✅ 主 API：百度翻译
✅ 备用 API：LibreTranslate
✅ 启用翻译缓存（减少 API 调用）
✅ 启用备用方案（提高可用性）
```

## 📊 成本分析

### 百度翻译（推荐）

- **免费额度**：200 万字符/月
- **单次翻译**：约 100-200 字符
- **可翻译次数**：约 1-2 万次/月
- **日均使用**：约 330-660 次/天
- **结论**：✅ 对个人用户完全够用

### LibreTranslate（备用）

- **费用**：完全免费
- **限制**：无限制
- **结论**：✅ 最佳免费备选方案

### DeepSeek（不推荐）

- **费用**：约 ¥0.002/次
- **月费用**（1000 次）：约 ¥2
- **结论**：⚠️ 有更好的免费方案

---

## 🔐 安全特性详解

### 1. API 密钥安全

- ✅ 不在代码中硬编码
- ✅ 存储在 `chrome.storage.sync`
- ✅ 仅本地存储，不上传服务器
- ✅ 用户自主配置和管理

### 2. 请求频率限制

```
每分钟：最多 30 次
每小时：最多 500 次
```

**目的：** 防止 API 滥用，保护账户安全

### 3. 智能缓存

- **缓存时长**：7 天
- **最大缓存**：1000 条
- **自动清理**：过期和多余缓存
- **效果**：大幅减少 API 调用

### 4. 备用方案

- **主 API 失败** → 自动切换备用 API
- **多层保障** → 提高服务可用性
- **用户无感知** → 自动切换，无需手动操作

---

## 📚 相关文档

- [安全使用指南](SECURITY_GUIDE.md) - 详细的安全说明和最佳实践
- [更新日志](CHANGELOG.md) - 版本更新历史
- [功能规格](docs/specs/1-deepseek-translator/spec.md) - 完整的功能需求文档

---

## ⚠️ 注意事项

1. **首次使用需要配置**：v2.0 版本不再包含硬编码密钥
2. **推荐使用免费 API**：百度翻译或 LibreTranslate
3. **不要分享 API 密钥**：密钥是您的私人凭证
4. **遵守服务条款**：不要滥用 API 服务
5. **定期检查配额**：避免超出免费额度

---

## 已知限制

1. **浏览器兼容性**：仅支持 Chrome 浏览器（Manifest V3）
2. **翻译方向**：仅支持英译中（未来将支持更多）
3. **文本长度**：单次翻译最大 5000 字符
4. **离线模式**：需要网络连接
5. **图标**：当前使用占位图标

## 未来改进

- [ ] 添加翻译历史记录功能
- [ ] 支持更多语言对（中译英、日译中等）
- [ ] 添加快捷键支持
- [ ] 支持复制译文到剪贴板
- [ ] 深色模式支持
- [ ] 自定义抽屉位置（左侧/右侧）

## 许可证

MIT

## 作者

根据功能规格文档 (docs/specs/1-deepseek-translator/spec.md) 开发

