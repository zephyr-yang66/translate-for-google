# 安全使用指南

## 🔐 安全特性

本翻译扩展经过全面的安全改造，实现了以下安全特性：

### 1. **API 密钥保护**

✅ **不再硬编码密钥**
- 所有 API 密钥现在存储在 `chrome.storage.sync` 中
- 密钥仅保存在用户本地浏览器，不会上传到任何服务器
- 代码中不包含任何明文密钥

✅ **用户自主配置**
- 首次安装时自动打开配置页面
- 用户需要自行申请并配置 API 密钥
- 支持多种翻译服务切换

### 2. **请求频率限制**

为防止 API 滥用和保护用户账户安全，实现了自动限流：

- **每分钟最多 30 次请求**
- **每小时最多 500 次请求**
- 超过限制时自动提示用户

### 3. **翻译缓存机制**

✅ **智能缓存**
- 相同文本不会重复调用 API
- 缓存有效期：7 天
- 自动清理过期和多余缓存
- 最大缓存 1000 条记录

✅ **成本节省**
- 大幅减少 API 调用次数
- 节省用户 API 配额
- 提高响应速度

### 4. **多 API 备用方案**

✅ **高可用性**
- 主 API 失败时自动切换到备用 API
- 按优先级依次尝试：主 API → 备用 API 1 → 备用 API 2
- 降低服务不可用风险

### 5. **输入验证**

✅ **安全检查**
- 验证 API 密钥格式
- 限制翻译文本长度（最大 5000 字符）
- 检查空输入和非法输入

---

## 📋 如何安全使用

### 第一步：选择翻译服务

根据您的需求选择合适的翻译服务：

#### 推荐方案：百度翻译（免费）

**优点：**
- ✅ 每月 200 万字符免费额度
- ✅ 翻译质量优秀
- ✅ 国内访问速度快
- ✅ 完全免费（完成认证后）

**如何获取：**
1. 访问 [百度翻译开放平台](https://fanyi-api.baidu.com/)
2. 注册并登录账号
3. 进入「管理控制台」→「开发者信息」
4. 获取 APP ID 和密钥
5. 完成身份认证以获得免费额度

#### 备选方案：LibreTranslate（完全免费）

**优点：**
- ✅ 完全免费，无使用限制
- ✅ 开源方案，可自建服务器
- ✅ 无需注册 API 密钥

**使用方式：**
- 直接选择 LibreTranslate
- 使用默认地址即可
- 或自建服务器获得更好性能

#### 付费方案：DeepSeek AI

**特点：**
- 💰 付费服务，约 ¥0.002/次
- ✅ 翻译质量最好
- ⚠️ 不推荐作为主要方案

---

### 第二步：配置 API 密钥

1. **打开配置页面**
   - 点击扩展图标
   - 或右键扩展图标 → 「选项」

2. **选择翻译服务**
   - 推荐选择「百度翻译 API」

3. **填写 API 密钥**
   - 输入您的 APP ID 和密钥
   - 点击「🧪 测试连接」验证配置
   - 点击「💾 保存设置」

4. **启用高级功能**
   - ✅ 启用翻译缓存（强烈推荐）
   - ✅ 启用 API 备用方案（提高可用性）

---

### 第三步：安全使用建议

#### ✅ 推荐做法

1. **优先使用免费 API**
   - 百度翻译：200 万字符/月免费
   - LibreTranslate：完全免费

2. **启用缓存功能**
   - 减少 API 调用次数
   - 节省免费配额
   - 提高响应速度

3. **启用备用方案**
   - 主 API 失败时自动切换
   - 提高服务可用性

4. **定期检查配额**
   - 登录百度翻译控制台
   - 查看剩余免费额度
   - 避免超额使用

#### ⚠️ 注意事项

1. **不要分享 API 密钥**
   - API 密钥是您的私人凭证
   - 不要在公共场合分享
   - 定期更换密钥

2. **不要滥用服务**
   - 合理使用翻译功能
   - 不要批量自动化调用
   - 遵守服务提供商的使用条款

3. **备份您的配置**
   - 记录您的 APP ID 和密钥
   - 保存在安全的地方
   - 方便换设备时恢复

---

## 🔧 高级配置

### 1. 多 API 配置（推荐）

**场景：** 提高服务可用性

**配置方式：**
1. 主 API 选择：百度翻译
2. 填写百度翻译配置
3. 同时配置 LibreTranslate（无需密钥）
4. 启用「API 备用方案」

**效果：**
- 百度翻译失败 → 自动切换到 LibreTranslate
- 大幅提高服务可用性

### 2. 缓存管理

**查看缓存统计：**
- 打开浏览器控制台（F12）
- 切换到扩展后台页面
- 查看缓存记录数和大小

**清空缓存：**
```javascript
// 在扩展后台页面的控制台执行
chrome.storage.local.clear()
```

### 3. 请求频率调整

如需调整请求频率限制，修改 `src/utils/rate-limiter.ts`：

```typescript
private readonly MAX_REQUESTS_PER_MINUTE = 30; // 调整这里
private readonly MAX_REQUESTS_PER_HOUR = 500;  // 调整这里
```

---

## 🛡️ 隐私保护

### 数据存储位置

- **API 密钥**：`chrome.storage.sync`（同步到您的 Chrome 账户）
- **翻译缓存**：`chrome.storage.local`（仅本地存储）
- **不收集任何用户数据**

### 网络请求

- 仅向您配置的翻译服务发送请求
- 请求内容：待翻译文本
- 响应内容：翻译结果
- 不经过任何第三方服务器

### 权限说明

扩展需要的权限：
- `contextMenus`：添加右键菜单
- `activeTab`：访问当前标签页的文本
- `storage`：保存配置和缓存
- `notifications`：显示错误提示
- `host_permissions`：访问翻译 API

---

## ❓ 常见问题

### Q1: API 密钥会被泄露吗？

**A:** 不会。密钥只存储在您的本地浏览器中，不会上传到任何服务器。

### Q2: 每月 200 万字符够用吗？

**A:** 非常够用！
- 1 次翻译平均 100 字符
- 200 万字符 = 约 2 万次翻译
- 平均每天可翻译 660 次

### Q3: 如果百度翻译配额用完了怎么办？

**A:** 可以切换到 LibreTranslate（完全免费）或配置多个备用 API。

### Q4: 翻译内容会被保存吗？

**A:** 仅在启用缓存时本地保存，7 天后自动清理。不会上传到任何服务器。

### Q5: 为什么首次安装要配置密钥？

**A:** 为了安全，我们不在代码中硬编码密钥。您需要使用自己的 API 密钥，确保账户安全。

---

## 📞 技术支持

遇到问题？
1. 检查 API 密钥是否正确
2. 测试网络连接
3. 查看浏览器控制台错误信息
4. 尝试切换到备用 API

---

## 🎉 开始使用

现在您已经了解了所有安全特性，可以放心使用了！

1. ✅ 配置好 API 密钥
2. ✅ 启用缓存和备用方案
3. ✅ 开始翻译

**祝您使用愉快！** 🚀

